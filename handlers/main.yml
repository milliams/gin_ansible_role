---
- name: Restart gin
  ansible.builtin.systemd:
    state: restarted
    name: pod-gin
    daemon-reload: true
  become: yes
  become_user: ginuser
  environment:
    XDG_RUNTIME_DIR: "/run/user/{{ ginuser_user.uid }}"
  listen: "Restart gin"

- name: Wait for gin web service
  ansible.builtin.uri:
    url: "http://localhost:{{ gin_http_port }}/"
    headers:
      Host: "{{ gin_domain }}"
    validate_certs: false
  register: result
  until: result.status == 200
  retries: 60
  delay: 1
  listen:
    - "Restart gin"
    - "Wait gin"
